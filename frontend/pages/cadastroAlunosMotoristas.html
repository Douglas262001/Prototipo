<html>
    <head> 
        <link rel="stylesheet" type="text/css" href="../css/style.css">
        <script>
            const carregarAlunos = () => {
                fetch('http://localhost:3000/alunos')
                    .then((response) => response.json())
                    .then((dados) => {
                        document.getElementById('conteudo-alunos').innerHTML = dados.reverse().reduce((acumulador, aluno) => {
                            return acumulador + `
                                <div style='display: flex; gap: 4px;'>
                                    <input id='aluno-id-${aluno.id}' disabled style='color: red; width: 50px;' value='${aluno.id}'></input>
                                    <input id='aluno-nome-${aluno.id}' style='color: red' value='${aluno.nome}'></input>
                                    <input id='aluno-sobrenome-${aluno.id}' style='color: red' value='${aluno.url}'></input>
                                    <input id='aluno-idade-${aluno.id}' style='color: red' value='${aluno.status_aluno}'></input>
                                    <input id='aluno-cpf-${aluno.id}' style='color: red' value='${aluno.apelido}'></input>
                                    <input id='aluno-motorista-${aluno.id}' style='color: red' value='${aluno.motorista}'></input>
                                    <button onclick="alterarAluno(${aluno.id})">Alterar</button>
                                    <button onclick="excluirAluno(${aluno.id})">Excluir</button>
                                </div>
                            `;
                        }, '');
                    })
            }

            const alterarAluno = (id) => {
                const nome = document.getElementById(`aluno-nome-${id}`).value;
                const url = document.getElementById(`aluno-url-${id}`).value;
                const status_aluno = document.getElementById(`aluno-status_aluno-${id}`).value;
                const apelido = document.getElementById(`aluno-apelido-${id}`).value;
                const motorista = document.getElementById(`aluno-motorista-${id}`).value;
                fetch(`http://localhost:3000/alunos/${id}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({nome: nome, url: url, status_aluno: status_aluno, apelido: apelido, motorista: motorista})
                }).then(async (resposta) => {
                    mostrarMensagem(await resposta.json());
                    carregarAlunos();
                })
            }

            const excluirAluno = (id) => {
                fetch(`http://localhost:3000/alunos/${id}`, {
                    method: 'DELETE',
                }).then(async (resposta) => {
                    mostrarMensagem(await resposta.json(), 'rgb(255 59 59 / 77%)');
                    carregarAlunos();
                })
            }

            const inserirAluno = (aluno = {}) => {
                const nome = document.getElementById('nome').value;
                const url = document.getElementById('url').value;
                const status_aluno = document.getElementById('status_aluno').value;
                const apelido = document.getElementById('apelido').value;
                const motorista = document.getElementById('motorista').value;
                fetch('http://localhost:3000/alunos', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({nome: nome, url: url, status_aluno: status_aluno, apelido: apelido, motorista: motorista})
                }).then(async (resposta) => {
                    mostrarMensagem(await resposta.json(), 'rgb(59 255 59 / 77%)');
                    limparCampos();
                    carregarAlunos();
                })
            }

            const limparCampos = () => {
                document.getElementById('nome').value = '';
                document.getElementById('url').value = '';
                document.getElementById('status_aluno').value = '';
                document.getElementById('apelido').value = '';
                document.getElementById('motorista').value = '';
            }

            const mostrarMensagem = (mensagem, corFundo = 'rgb(59 59 255 / 77%)') => {
                const codigoMensagem = Math.random();
                const div = document.createElement('div');
                div.id = `mensagem-${codigoMensagem}`;
                div.innerText = mensagem;
                div.style = `background: ${corFundo}; color: white; padding: 10px;`;
                const elementoMensagens = document.getElementById('mensagens');
                elementoMensagens.insertBefore(div, elementoMensagens.firstChild);
                setTimeout(() => {
                    document.getElementById(`mensagem-${codigoMensagem}`).remove();
                }, 5000);
            }
        </script>
    </head>
    <body>
        <div class="container">
            <button onclick="carregarAlunos()">Carregar Alunos</button>
            <br></br>
            <div>
                <input id="nome" placeholder="Nome"></input>
                <input id="url" placeholder="URL"></input>
                <input id="status_aluno" placeholder="Status Aluno"></input>
                <input id="apelido" placeholder="Apelido"></input>
                <input id="motorista" placeholder="Motorista"></input>
                <button onclick="inserirAluno()">Inserir</button>
            </div>
            <div id="conteudo-alunos">
                <h1>
                    Clique no bot√£o de carregar alunos para ver a lista.
                </h1>
            </div>
            <div id="mensagens" style="display: flex; flex-flow: column; gap: 4px; position: fixed; top: 0; bottom: 0; right: 0; width: 200px; z-index: 2; pointer-events: none;">
            </div>
        </div>
    </body>
</html>